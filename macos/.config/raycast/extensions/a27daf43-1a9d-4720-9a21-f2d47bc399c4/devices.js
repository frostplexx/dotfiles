"use strict";var D=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var O=(e,t)=>{for(var s in t)D(e,s,{get:t[s],enumerable:!0})},A=(e,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of M(t))!k.call(e,n)&&n!==s&&D(e,n,{get:()=>t[n],enumerable:!(o=w(t,n))||o.enumerable});return e};var _=e=>A(D({},"__esModule",{value:!0}),e);var V={};O(V,{default:()=>L});module.exports=_(V);var i=require("@raycast/api"),f=require("react");var y=require("@raycast/api"),v=require("node:child_process"),I="tag:mullvad-exit-node",p=class extends Error{},g=class extends Error{},d=class extends Error{},m=class extends Error{},x=class extends Error{};function T(){let e=R("status --json"),t=JSON.parse(e);if(!t||!t.Self.Online)throw new d;return t}function b(e){let t=[],s=e.Self,o={self:!0,key:s.ID,name:s.DNSName.split(".")[0],userid:s.UserID.toString(),dns:s.DNSName,ipv4:s.TailscaleIPs[0],ipv6:s.TailscaleIPs[1],os:s.OS,online:s.Online,lastseen:new Date(s.LastSeen),exitnode:s.ExitNode,exitnodeoption:s.ExitNodeOption,tags:s.Tags};t.push(o);for(let[,n]of Object.entries(e.Peer)){let c={self:!1,key:n.ID,name:n.DNSName.split(".")[0],userid:n.UserID.toString(),dns:n.DNSName,ipv4:n.TailscaleIPs[0],ipv6:n.TailscaleIPs[1],os:n.OS=="linux"?"Linux":n.OS,online:n.Online,lastseen:new Date(n.LastSeen),exitnode:n.ExitNode,exitnodeoption:n.ExitNodeOption,tags:n.Tags};t.push(c)}return t}function C(e){e.sort((t,s)=>t.self?-1:s.self?1:t.online&&!s.online?-1:!t.online&&s.online?1:t.name.localeCompare(s.name))}var r=(0,y.getPreferenceValues)(),U=r.tailscalePath&&r.tailscalePath.length>0?r.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",B=r.tailscaleExecMaxBuffersMB&&r.tailscaleExecMaxBuffersMB?r.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function R(e){try{return(0,v.execSync)(`${U} ${e}`,{maxBuffer:B}).toString().trim()}catch(t){if(t instanceof Error){if(t.message.includes("No such file or directory"))throw new p;if(t.message.includes("is Tailscale running?"))throw new g;if(t.message.includes("spawnSync /bin/sh ENOBUFS"))throw new m;if(t.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new x}throw console.log(`throwing error: ${t}`),t}}function E(e,t){return e instanceof p?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof g?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof d?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof m?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof x?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:t})}var a=require("@raycast/api"),l=require("react/jsx-runtime");function S({device:e}){return(0,l.jsxs)(a.ActionPanel,{children:[(0,l.jsx)(a.Action.CopyToClipboard,{content:e.ipv4,title:"Copy IPv4"}),(0,l.jsx)(a.Action.CopyToClipboard,{content:e.dns.endsWith(".")?e.dns.slice(0,-1):e.dns,title:"Copy MagicDNS"}),(0,l.jsx)(a.Action.CopyToClipboard,{content:e.ipv6,title:"Copy IPv6"})]})}var u=require("react/jsx-runtime");function L(){let[e,t]=(0,f.useState)(),[s,o]=(0,f.useState)();return(0,f.useEffect)(()=>{async function n(){try{let c=T(),h=b(c).filter(P=>!P.tags?.includes(I));C(h),t(h)}catch(c){o(E(c,"Couldn\u2019t load device list."))}}n()},[]),(0,u.jsx)(i.List,{isLoading:!e&&!s,children:s?(0,u.jsx)(i.List.EmptyView,{icon:i.Icon.Warning,title:s.title,description:s.description}):e?.map(n=>(0,u.jsx)(i.List.Item,{title:n.name,subtitle:n.ipv4+"   "+n.os,icon:n.online?{source:{light:"connected_light.png",dark:"connected_dark.png"},mask:i.Image.Mask.Circle}:{source:{light:"lastseen_light.png",dark:"lastseen_dark.png"},mask:i.Image.Mask.Circle},accessories:n.self?[{text:"This device",icon:i.Icon.Person},{text:n.online?"        Connected":"Last seen "+N(n.lastseen)}]:[{text:n.online?"        Connected":"Last seen "+N(n.lastseen)}],actions:(0,u.jsx)(S,{device:n})},n.key))})}function N(e){return e.toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}
