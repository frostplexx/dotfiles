"use strict";var m=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var P=(e,n)=>{for(var r in n)m(e,r,{get:n[r],enumerable:!0})},U=(e,n,r,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of E(n))!N.call(e,i)&&i!==r&&m(e,i,{get:()=>n[i],enumerable:!(s=b(n,i))||s.enumerable});return e};var L=e=>U(m({},"__esModule",{value:!0}),e);var C={};P(C,{default:()=>w});module.exports=L(C);var t=require("@raycast/api"),f=require("react");var S=require("@raycast/api"),D=require("node:child_process");var u=class extends Error{},g=class extends Error{},x=class extends Error{},p=class extends Error{},d=class extends Error{};var l=(0,S.getPreferenceValues)(),M=l.tailscalePath&&l.tailscalePath.length>0?l.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",O=l.tailscaleExecMaxBuffersMB&&l.tailscaleExecMaxBuffersMB?l.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function h(e){try{return(0,D.execSync)(`${M} ${e}`,{maxBuffer:O}).toString().trim()}catch(n){if(n instanceof Error){if(n.message.includes("No such file or directory"))throw new u;if(n.message.includes("is Tailscale running?"))throw new g;if(n.message.includes("spawnSync /bin/sh ENOBUFS"))throw new p;if(n.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new d}throw console.log(`throwing error: ${n}`),n}}function v(e,n){return e instanceof u?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof g?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof x?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof p?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof d?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:n})}var c=require("react/jsx-runtime");function A(e){let n=[];e[0]?.startsWith("ID")&&(e=e.slice(1));for(let r of e){let s=r.split(" ").filter(Boolean),i={};s.length==3?i={name:s[1],active:s[2].includes("*")}:s.length==2&&(i={name:s[1].replace(/\*$/,""),active:s[1].includes("*")}),s.length==1&&(i={name:s[0].replace(/\*$/,""),active:s[0].includes("*")}),n.push(i)}return n}function w(){let[e,n]=(0,f.useState)(),[r,s]=(0,f.useState)();(0,f.useEffect)(()=>{async function o(){try{let T=h("switch --list").split(`
`),I=A(T);n(I)}catch(a){s(v(a,"Couldn\u2019t load users."))}}o()},[]);let i={source:t.Icon.PersonCircle,tintColor:t.Color.Green},y={source:t.Icon.PersonCircle};return(0,c.jsx)(t.List,{isLoading:!e&&!r,children:r?(0,c.jsx)(t.List.EmptyView,{icon:t.Icon.Warning,title:r.title,description:r.description}):e?.sort((o,a)=>+o.active-+a.active).map(o=>(0,c.jsx)(t.List.Item,{title:o.name,icon:o.active?i:y,subtitle:o.active?"Active user":"",actions:(0,c.jsx)(t.ActionPanel,{children:(0,c.jsx)(t.Action,{title:"Switch to User",onAction:async()=>{await(0,t.showToast)({style:t.Toast.Style.Animated,title:"Switching user account",message:`${o.name}`}),(0,t.popToRoot)(),(0,t.closeMainWindow)();let a=h(`switch ${o.name}`);a.includes("Success")||a.includes("Already")?(0,t.showHUD)(`Active Tailscale user is ${o.name}`):(0,t.showHUD)(`Tailscale user failed to switch to ${o.name}`)}})})},o.name))})}
